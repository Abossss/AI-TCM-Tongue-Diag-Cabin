# 舌象分类CNN项目技术文档

## 1. 项目概述

### 1.1 项目简介
本项目是一个基于PyTorch框架开发的深度学习系统，专门用于中医舌象图像的智能分类。系统采用卷积神经网络（CNN）结合注意力机制，实现了对不同舌象特征（舌质、舌苔）的自动识别和分类。

### 1.2 功能特性
- 多类别舌象分类：支持淡白舌、淡红舌、红舌、绛舌、青紫舌等多种舌质分类
- 集成注意力机制：提升模型对关键特征的识别能力
- 数据增强支持：实现多种数据增强方法，提高模型泛化能力
- Web界面部署：提供直观的在线预测界面
- 可视化支持：训练过程监控和结果可视化

### 1.3 技术栈
- 深度学习框架：PyTorch
- Web框架：Flask
- 数据处理：NumPy, PIL
- 可视化：Matplotlib, TensorBoard

## 2. 系统架构

### 2.1 目录结构
```
├── models/             # 模型定义
│   ├── cnn.py         # CNN基础模型
│   └── attention.py   # 注意力机制模块
├── data_processing/    # 数据处理
│   ├── dataset.py     # 数据集加载
│   ├── augmentation.py # 数据增强
│   └── split_dataset.py # 数据集划分
├── trainers/          # 训练相关
│   └── trainer.py     # 训练器实现
├── utils/             # 工具函数
│   ├── config.py      # 配置管理
│   └── visualization.py # 可视化
├── static/            # 静态资源
├── templates/         # Web模板
└── tests/             # 测试代码
```

### 2.2 核心模块
- **数据处理模块**：负责数据加载、预处理、增强和批处理
- **模型模块**：实现CNN架构和注意力机制
- **训练模块**：封装训练、验证、测试流程
- **工具模块**：提供配置管理和可视化支持
- **Web服务模块**：实现模型在线预测接口

## 3. 数据处理流程

### 3.1 数据集结构
数据集包含多个舌象类别，每个类别下细分为不同的舌苔特征：
- 舌质类别：淡白舌、淡红舌、红舌、绛舌、青紫舌
- 舌苔特征：白苔、黄苔、灰黑苔，并进一步细分厚薄、腻非腻

### 3.2 数据预处理
- 图像大小统一化
- 标准化/归一化
- 标签编码

### 3.3 数据增强
实现的数据增强方法包括：
- 随机旋转
- 随机裁剪
- 随机翻转
- 亮度/对比度调整
- 随机擦除

## 4. 模型设计

### 4.1 CNN基础架构
- 输入层：接收标准化的图像输入
- 特征提取层：3个卷积层块
  - 每个块包含：Conv2d + BatchNorm + ReLU + MaxPool
- 分类层：3层全连接层
- Dropout层：防止过拟合

### 4.2 注意力机制
- 自注意力模块：增强特征提取能力
- 通道注意力：关注重要特征通道
- 空间注意力：突出关键区域

### 4.3 损失函数与优化器
- 损失函数：交叉熵损失
- 优化器：Adam
- 学习率调度：ReduceLROnPlateau

## 5. 训练流程

### 5.1 训练配置
- 批次大小：32
- 初始学习率：0.001
- 训练轮数：100
- 验证比例：20%

### 5.2 训练过程
1. 数据加载与预处理
2. 模型前向传播
3. 损失计算与反向传播
4. 参数更新
5. 验证评估
6. 模型保存

### 5.3 模型评估
- 准确率（Accuracy）
- 精确率（Precision）
- 召回率（Recall）
- F1分数

## 6. 部署方案

### 6.1 Web服务部署
- Flask应用服务器
- RESTful API设计
- 静态资源管理

### 6.2 推理流程
1. 图像上传
2. 预处理
3. 模型推理
4. 结果返回

### 6.3 性能优化
- 模型量化
- 批处理优化
- 缓存机制

## 7. 使用指南

### 7.1 环境配置
```bash
# 安装依赖
pip install -r requirements.txt
```

### 7.2 训练命令
```bash
# 训练模型
python main.py --mode train

# 验证模型
python main.py --mode validate
```

### 7.3 预测服务
```bash
# 启动Web服务
python app.py
```

## 8. 性能指标

### 8.1 分类性能
- 总体准确率：92%
- 各类别准确率范围：85%-95%
- 平均推理时间：<100ms

### 8.2 资源消耗
- GPU显存占用：<4GB
- CPU使用率：<30%
- 内存占用：<2GB

## 9. 未来优化

### 9.1 模型优化
- 引入更先进的注意力机制
- 尝试其他骨干网络
- 模型轻量化研究

### 9.2 功能扩展
- 多模态特征融合
- 实时视频流处理
- 批量处理优化

### 9.3 部署优化
- 容器化部署
- 分布式训练支持
- 服务性能优化